최근 회사에서 다소 까다로운 데이터 핸들링 상황을 맞이했는데...  
이유는 예상치 못한 암묵적 함정들이 꽤 많아서였다.  
별거 아닌 상황같은데 함정이 의외로 많았... =_=.....  

이에 그 중 하나를 간단한 문제로 정리해보면 좋겠다는 생각이 들어 글을 써본다.  

===========  

문제)

A사는 잘 안 팔리는 아이템 리스트를 모아 매주 월요일 그 재고상황을 스냅샷 테이블로 만든다.  
이후 해당 스냅샷 아이템 리스트 기반으로 할인행사를 진행한다. (해당 아이템은 상점 내 모든 판매에 대해 자동 할인적용)  
만약 해당 할인행사에서 충분히 많이 팔리면 다음 주엔 스냅샷에서 제외된다.  

위에 설명한 주별 스냅샷 테이블과 한 달 간의 할인행사 판매데이터가 아래와 같이 주어졌을 때 판매율을 계산하시오.  

```{r}

library(tidyr)
library(dplyr)
library(scales)

rm(list=ls())

snapshot = tribble(
  ~snapshot_dt, ~item, ~unit_available,
  '2022-08-01', 'A', 500, 
  '2022-08-08', 'A', 470, 
  '2022-08-15', 'A', 350, 
  '2022-08-15', 'B', 350, 
  '2022-08-22', 'A', 150, 
  '2022-08-22', 'B', 150, 
  '2022-08-29', 'A', 50 
)

order = tribble(
  ~order_dttm, ~item, ~unit_sold,
  '2022-08-01 13:30', 'A', 	10 ,
  '2022-08-02 17:13', 'A', 	50 ,
  '2022-08-07 15:03', 'A',  -30 ,
  '2022-08-09 02:01', 'A', 	80 ,
  '2022-08-10 00:03', 'A', 	20 ,
  '2022-08-11 20:10', 'A', 	20 ,
  '2022-08-20 06:17', 'A', 	200, 
  '2022-08-20 06:17', 'B', 	500, 
  '2022-08-23 00:00', 'A', 	20 ,
  '2022-08-23 04:03', 'A', 	90 ,
  '2022-08-28 00:30', 'A',  -10 
)
```